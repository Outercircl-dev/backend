generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
  schemas  = ["auth", "public"]
}

model Interest {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  slug       String    @unique @db.VarChar(50)
  name       String    @db.VarChar(100)
  category   String    @db.VarChar(50)
  icon       String?   @db.VarChar(10)
  sort_order Int?      @default(0)
  created_at DateTime? @default(now()) @db.Timestamptz(6)

  @@map("interests")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user_profiles {
  id                     String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                String      @unique @db.Uuid
  full_name              String      @db.VarChar(100)
  date_of_birth          DateTime    @db.Date
  gender                 gender_type
  profile_picture_url    String?     @db.VarChar(512)
  bio                    String?
  interests              Json        @default("[]")
  hobbies                String[]    @default([])
  availability           Json?       @default("{}")
  distance_radius_km     Int?        @default(25)
  accepted_tos           Boolean     @default(false)
  accepted_guidelines    Boolean     @default(false)
  accepted_tos_at        DateTime?   @db.Timestamptz(6)
  accepted_guidelines_at DateTime?   @db.Timestamptz(6)
  profile_completed      Boolean?    @default(false)
  is_verified            Boolean?    @default(false)
  created_at             DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at             DateTime?   @default(now()) @db.Timestamptz(6)
  confirmed_age          Boolean     @default(false)
  confirmed_platonic     Boolean     @default(false)

  activityParticipants    ActivityParticipant[]
  issuedActivityInvites   ActivityInvite[]      @relation("issuer_profile")
  receivedActivityInvites ActivityInvite[]      @relation("invitee_profile")
  activityGroups          ActivityGroup[]
  activityGroupMembers    ActivityGroupMember[]
  activitySeries          ActivitySeries[]
  activityMessages        ActivityMessage[]     @relation("activity_message_author")
  activityMessageReports  ActivityMessageReport[]

  @@index([created_at(sort: Desc)], map: "idx_user_profiles_created_at")
  @@index([interests], map: "idx_user_profiles_interests", type: Gin)
  @@index([user_id], map: "idx_user_profiles_user_id")
  @@schema("public")
}

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model audit_log_entries {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model flow_state {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model identities {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model instances {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model mfa_amr_claims {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model mfa_challenges {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model mfa_factors {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
// model oauth_authorizations {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
// model oauth_client_states {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
// model oauth_clients {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
// model oauth_consents {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model one_time_tokens {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model refresh_tokens {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model saml_providers {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model saml_relay_states {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model schema_migrations {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model sessions {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
// model sso_domains {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
// model sso_providers {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
// model users {
// @@schema("auth")
// }

enum aal_level {
  aal1
  aal2
  aal3

  @@schema("auth")
}

enum code_challenge_method {
  s256
  plain

  @@schema("auth")
}

enum factor_status {
  unverified
  verified

  @@schema("auth")
}

enum factor_type {
  totp
  webauthn
  phone

  @@schema("auth")
}

enum oauth_authorization_status {
  pending
  approved
  denied
  expired

  @@schema("auth")
}

enum oauth_client_type {
  public
  confidential

  @@schema("auth")
}

enum oauth_registration_type {
  dynamic
  manual

  @@schema("auth")
}

enum oauth_response_type {
  code

  @@schema("auth")
}

enum one_time_token_type {
  confirmation_token
  reauthentication_token
  recovery_token
  email_change_token_new
  email_change_token_current
  phone_change_token

  @@schema("auth")
}

enum gender_type {
  male
  female
  other
  prefer_not_to_say

  @@schema("public")
}

enum activity_status {
  draft
  published
  completed
  cancelled

  @@schema("public")
}

enum activity_message_type {
  user
  system
  announcement
  survey

  @@schema("public")
}

enum participation_status {
  pending
  confirmed
  waitlisted
  cancelled

  @@schema("public")
}

enum invite_status {
  pending
  redeemed
  revoked
  expired

  @@schema("public")
}

enum recurrence_frequency {
  daily
  weekly
  monthly

  @@schema("public")
}

enum group_member_role {
  owner
  member

  @@schema("public")
}

enum activity_message_type {
  user
  system
  announcement
  survey

  @@schema("public")
}

model Activity {
  id                   String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  // Note: host_id references auth.users(id) but lacks @relation annotation
  // This is intentional as auth.users is Supabase-managed and Prisma cannot enforce
  // referential integrity across schemas. The foreign key constraint is enforced
  // at the database level via SQL migration.
  host_id              String          @db.Uuid
  title                String          @db.VarChar(255)
  description          String?
  category             String?         @db.VarChar(50)
  interests            Json            @default("[]")
  location             Json
  activity_date        DateTime        @db.Date
  start_time           DateTime        @db.Time(6)
  end_time             DateTime?       @db.Time(6)
  max_participants     Int
  current_participants Int             @default(0)
  status               activity_status @default(draft)
  is_public            Boolean         @default(true)
  created_at           DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?       @updatedAt @db.Timestamptz(6)
  group_id             String?         @db.Uuid
  series_id            String?         @db.Uuid

  participants ActivityParticipant[]
  invites      ActivityInvite[]
  messages     ActivityMessage[]
  group        ActivityGroup?        @relation(fields: [group_id], references: [id])
  series       ActivitySeries?       @relation(fields: [series_id], references: [id])
  messages     ActivityMessage[]

  @@index([host_id], map: "idx_activities_host_id")
  @@index([created_at(sort: Desc)], map: "idx_activities_created_at")
  @@index([activity_date], map: "idx_activities_activity_date")
  @@index([status], map: "idx_activities_status")
  @@index([category], map: "idx_activities_category")
  @@index([interests], map: "idx_activities_interests_gin", type: Gin)
  @@index([location], map: "idx_activities_location_gin", type: Gin)
  @@index([group_id], map: "idx_activities_group_id")
  @@index([series_id], map: "idx_activities_series_id")
  @@map("activities")
  @@schema("public")
}

model ActivityGroup {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  owner_profile_id String    @db.Uuid
  name             String    @db.VarChar(120)
  description      String?
  is_public        Boolean   @default(false)
  max_members      Int       @default(15)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @updatedAt @db.Timestamptz(6)

  owner      user_profiles         @relation(fields: [owner_profile_id], references: [id], onDelete: Cascade)
  members    ActivityGroupMember[]
  activities Activity[]

  @@index([owner_profile_id], map: "idx_activity_groups_owner_id")
  @@map("activity_groups")
  @@schema("public")
}

model ActivityGroupMember {
  id         String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  group_id   String            @db.Uuid
  profile_id String            @db.Uuid
  role       group_member_role @default(member)
  joined_at  DateTime?         @default(now()) @db.Timestamptz(6)

  group   ActivityGroup @relation(fields: [group_id], references: [id], onDelete: Cascade)
  profile user_profiles @relation(fields: [profile_id], references: [id], onDelete: Cascade)

  @@unique([group_id, profile_id], map: "uq_activity_group_membership")
  @@index([profile_id], map: "idx_activity_group_members_profile")
  @@map("activity_group_members")
  @@schema("public")
}

model ActivityMessage {
  id               String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  activity_id      String                @db.Uuid
  author_profile_id String?              @db.Uuid
  content          String
  message_type     activity_message_type @default(user)
  is_pinned        Boolean               @default(false)
  metadata         Json?                 @default("{}")
  created_at       DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?             @updatedAt @db.Timestamptz(6)

  activity Activity        @relation(fields: [activity_id], references: [id], onDelete: Cascade)
  author   user_profiles?  @relation("author", fields: [author_profile_id], references: [id], onDelete: SetNull)
  reports  ActivityMessageReport[]

  @@index([activity_id], map: "idx_activity_messages_activity_id")
  @@index([created_at(sort: Desc)], map: "idx_activity_messages_created_at")
  @@index([activity_id, is_pinned], map: "idx_activity_messages_pinned")
  @@map("activity_messages")
  @@schema("public")
}

model ActivityMessageReport {
  id                  String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  message_id          String        @db.Uuid
  reporter_profile_id String        @db.Uuid
  reason              String        @db.VarChar(120)
  details             String?
  created_at          DateTime?     @default(now()) @db.Timestamptz(6)

  message  ActivityMessage @relation(fields: [message_id], references: [id], onDelete: Cascade)
  reporter user_profiles   @relation(fields: [reporter_profile_id], references: [id], onDelete: Cascade)

  @@unique([message_id, reporter_profile_id], map: "uq_activity_message_reporter")
  @@index([message_id], map: "idx_activity_message_reports_message_id")
  @@map("activity_message_reports")
  @@schema("public")
}

model ActivitySeries {
  id               String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  owner_profile_id String               @db.Uuid
  frequency        recurrence_frequency
  interval         Int                  @default(1)
  ends_on          DateTime?            @db.Date
  occurrences      Int?
  created_at       DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?            @updatedAt @db.Timestamptz(6)

  owner      user_profiles @relation(fields: [owner_profile_id], references: [id], onDelete: Cascade)
  activities Activity[]

  @@index([owner_profile_id], map: "idx_activity_series_owner_id")
  @@map("activity_series")
  @@schema("public")
}

model ActivityParticipant {
  id                String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  activity_id       String               @db.Uuid
  profile_id        String               @db.Uuid
  status            participation_status @default(pending)
  waitlist_position Int?
  approval_message  String?
  invite_code       String?
  metadata          Json?                @default("{}")
  joined_at         DateTime?            @default(now()) @db.Timestamptz(6)
  approved_at       DateTime?            @db.Timestamptz(6)
  cancelled_at      DateTime?            @db.Timestamptz(6)
  updated_at        DateTime?            @updatedAt @db.Timestamptz(6)

  activity Activity      @relation(fields: [activity_id], references: [id], onDelete: Cascade)
  profile  user_profiles @relation(fields: [profile_id], references: [id], onDelete: Cascade)

  @@unique([activity_id, profile_id], map: "uq_activity_participants_activity_profile")
  @@index([activity_id, status], map: "idx_activity_participants_status")
  @@index([profile_id], map: "idx_activity_participants_profile_id")
  @@map("activity_participants")
  @@schema("public")
}

model ActivityInvite {
  id                 String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  activity_id        String        @db.Uuid
  issuer_profile_id  String        @db.Uuid
  invitee_profile_id String?       @db.Uuid
  invitee_email      String?       @db.VarChar(255)
  code               String        @unique @db.VarChar(32)
  status             invite_status @default(pending)
  metadata           Json?         @default("{}")
  expires_at         DateTime?     @db.Timestamptz(6)
  redeemed_at        DateTime?     @db.Timestamptz(6)
  revoked_at         DateTime?     @db.Timestamptz(6)
  created_at         DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?     @updatedAt @db.Timestamptz(6)

  activity       Activity       @relation(fields: [activity_id], references: [id], onDelete: Cascade)
  issuerProfile  user_profiles  @relation("issuer_profile", fields: [issuer_profile_id], references: [id], onDelete: Cascade)
  inviteeProfile user_profiles? @relation("invitee_profile", fields: [invitee_profile_id], references: [id])

  @@index([activity_id], map: "idx_activity_invites_activity_id")
  @@index([issuer_profile_id], map: "idx_activity_invites_issuer_id")
  @@index([invitee_profile_id], map: "idx_activity_invites_invitee_id")
  @@map("activity_invites")
  @@schema("public")
}

model ActivityMessage {
  id                String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  activity_id       String                @db.Uuid
  author_profile_id String?               @db.Uuid
  content           String
  message_type      activity_message_type @default(user)
  is_pinned         Boolean               @default(false)
  metadata          Json?                 @default("{}")
  created_at        DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?             @updatedAt @db.Timestamptz(6)

  activity Activity        @relation(fields: [activity_id], references: [id], onDelete: Cascade)
  author   user_profiles?  @relation("activity_message_author", fields: [author_profile_id], references: [id], onDelete: SetNull)
  reports  ActivityMessageReport[]

  @@index([activity_id], map: "idx_activity_messages_activity_id")
  @@index([created_at(sort: Desc)], map: "idx_activity_messages_created_at")
  @@index([activity_id, is_pinned], map: "idx_activity_messages_pinned")
  @@map("activity_messages")
  @@schema("public")
}

model ActivityMessageReport {
  id                  String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  message_id          String           @db.Uuid
  reporter_profile_id String           @db.Uuid
  reason              String           @db.VarChar(120)
  details             String?
  created_at          DateTime?        @default(now()) @db.Timestamptz(6)

  message  ActivityMessage @relation(fields: [message_id], references: [id], onDelete: Cascade)
  reporter user_profiles   @relation(fields: [reporter_profile_id], references: [id], onDelete: Cascade)

  @@unique([message_id, reporter_profile_id], map: "uq_activity_message_reporter")
  @@index([message_id], map: "idx_activity_message_reports_message_id")
  @@map("activity_message_reports")
  @@schema("public")
}
